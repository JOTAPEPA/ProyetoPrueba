import{_ as M,r as u,e as T,o as G,c as L,w as s,a as v,d as c,b as l,Q as i,f as k,g as H,F as O,N as b,n as R,t as j}from"./index-B-wX8S5p.js";import{Q,a as J,b as y}from"./QTable-DsPkTBfg.js";import{b as K,a as C,Q as A}from"./QPage-5EFWhCc5.js";import{u as W,g as X,a as w,Q as n,p as Y,b as U}from"./useAuth-B1U9RWE7.js";const Z={class:"main-btn-registrar"},h={key:0,style:{color:"green"}},ee={key:1,style:{color:"red"}},oe={__name:"Articulos",setup(le){const N=u([{name:"nombre",align:"center",label:"Nombre",field:"nombre",sortable:!0,style:"font-weight: bold;"},{name:"precio",align:"center",label:"Precio",field:"precio",sortable:!0},{name:"stock",align:"center",label:"Stock",field:"stock",sortable:!0},{name:"categoria",align:"center",label:"Categoria",field:a=>a.categoria?a.categoria.nombre:"",sortable:!0},{name:"estado",align:"center",label:"Estado",field:"estado",sortable:!0,style:"font-weight: bold;"},{name:"opciones",align:"center",label:"Opciones",field:"opciones",sortable:!0}]),E=u([]),d=u(!1),m=u(!1),p=u(!1),t=u({nombre:"",precio:"",stock:"",categoria:"",estado:1}),r=u({_id:"",nombre:"",precio:"",stock:"",categoria:"",estado:1}),V=u(null),S=W();T(()=>t.value.nombre&&t.value.precio&&t.value.stock&&t.value.categoria),G(async()=>{await f()});async function f(){const a=S.getToken();if(console.log("token recuperado del store",a),!a){console.log("token no encontrado");return}try{const e=await X("articulos");e&&Array.isArray(e)?E.value=e:console.log("La respuesta no contiene los datos esperados")}catch(e){console.log("Error al obtener los articulos",e.response?e.response.data:e)}}const _=a=>{V.value=a,d.value=!0},z=()=>{m.value=!0},B=()=>{m.value=!1,x()},x=()=>{t.value={nombre:"",precio:"",stock:"",categoria:"",estado:1}},D=async()=>{try{t.value.nombre=t.value.nombre.trim(),t.value.precio=t.value.precio.trim(),t.value.stock=t.value.stock.trim(),t.value.categoria=t.value.categoria.trim();const a=await Y("articulos",t.value);console.log("Articulo creado con exito",a),m.value=!1,b.create({message:"Articulo registrado exitosamente",color:"green",icon:"check_circle",position:"top",timeout:3e3}),await f(),x()}catch(a){console.log("Error al crear el articulo",a.response?a.response.data:a),a.response&&a.response.data&&a.response.data.errores?a.response.data.errores.forEach(o=>{o.msg?b.create({message:o.msg,color:"red",icon:"error",position:"top",timeout:3e3}):b.create({message:"Error desconocido",color:"red",icon:"error",position:"top",timeout:3e3})}):b.create({message:"Hubo un error en el registro. Inténtelo nuevamente.",color:"red",icon:"error",position:"top",timeout:3e3})}},F=a=>{r.value=a,p.value=!0},I=()=>{p.value=!1},P=async()=>{try{r.value.nombre=r.value.nombre.trim(),r.value.precio=r.value.precio.trim(),r.value.stock=r.value.stock.trim();const a=await U(`articulos/${r.value._id}`,r.value);console.log("Articulo actualizado con exito",a),b.create({message:"Articulo editado con éxito",color:"green",icon:"check_circle",position:"top",timeout:3e3}),p.value=!1,await f()}catch(a){console.log("Error al actualizar el articulo",a.response?a.response.data:a)}},$=async()=>{if(!V.value)return;const a=V.value;a.estado=a.estado===1?0:1;try{const e=await U(`articulos/${a._id}`,{estado:a.estado});console.log("articulo actualizado con exito",e),await f(),d.value=!1}catch(e){console.log("Error al actualizar el articulo",e.response?e.response.data:e)}},q=()=>{d.value=!1};return(a,e)=>(v(),L(K,{padding:""},{default:s(()=>[e[16]||(e[16]=c("h4",{class:"text-center text-weight-bold"},"Articulos",-1)),e[17]||(e[17]=c("hr",null,null,-1)),c("div",Z,[l(i,{label:"+ Registrar",onClick:z,class:"q-mb-md",id:"btn-registrar"})]),l(J,{class:"tabla-clientes",rows:E.value,columns:N.value,"row-key":"name"},{header:s(o=>[c("tr",null,[(v(!0),k(O,null,H(o.cols,g=>(v(),k("th",{key:g.name,class:R("tabla-header")},[c("span",null,j(g.label),1)]))),128))])]),"body-cell-estado":s(o=>[l(Q,{props:o,class:"q-pa-sm"},{default:s(()=>[o.row.estado==1?(v(),k("span",h,"Activo")):(v(),k("span",ee,"Inactivo"))]),_:2},1032,["props"])]),"body-cell-opciones":s(o=>[l(Q,{props:o,class:"tabla-cell opciones"},{default:s(()=>[l(i,{icon:"edit",color:"primary",flat:"",onClick:g=>F(o.row),class:"q-mr-sm"},null,8,["onClick"]),l(i,{icon:o.row.estado===1?"remove_circle":"check_circle",color:o.row.estado===1?"negative":"positive",flat:"",onClick:g=>_(o.row)},null,8,["icon","color","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),l(y,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=o=>d.value=o)},{default:s(()=>[l(C,null,{default:s(()=>[l(A,null,{default:s(()=>e[13]||(e[13]=[c("div",{class:"text-h6"},"¿Estás seguro de cambiar el estado?",-1)])),_:1}),l(w,null,{default:s(()=>[l(i,{label:"Cancelar",color:"secondary",flat:"",onClick:q}),l(i,{label:"Confirmar",color:"primary",flat:"",onClick:$})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(y,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=o=>m.value=o),persistent:""},{default:s(()=>[l(C,null,{default:s(()=>[l(A,null,{default:s(()=>[e[14]||(e[14]=c("div",{class:"text-h6"},"Agregar Nuevo Articulo ",-1)),l(n,{modelValue:t.value.nombre,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.nombre=o),label:"Nombre",filled:""},null,8,["modelValue"]),l(n,{modelValue:t.value.precio,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.precio=o),label:"Precio",filled:""},null,8,["modelValue"]),l(n,{modelValue:t.value.stock,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.stock=o),label:"Stock",filled:""},null,8,["modelValue"]),l(n,{modelValue:t.value.categoria,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.categoria=o),label:"Categoria",filled:""},null,8,["modelValue"]),l(n,{modelValue:t.value.estado,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.estado=o),label:"Estado",filled:"",type:"number",min:"0",max:"1"},null,8,["modelValue"])]),_:1}),l(w,null,{default:s(()=>[l(i,{label:"Cancelar",color:"secondary",flat:"",onClick:B}),l(i,{label:"Guardar",color:"primary",flat:"",onClick:D})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(y,{modelValue:p.value,"onUpdate:modelValue":e[12]||(e[12]=o=>p.value=o),persistent:""},{default:s(()=>[l(C,null,{default:s(()=>[l(A,null,{default:s(()=>[e[15]||(e[15]=c("div",{class:"text-h6"},"Editar ",-1)),l(n,{modelValue:r.value.nombre,"onUpdate:modelValue":e[7]||(e[7]=o=>r.value.nombre=o),label:"Nombre",filled:""},null,8,["modelValue"]),l(n,{modelValue:r.value.precio,"onUpdate:modelValue":e[8]||(e[8]=o=>r.value.precio=o),label:"Precio",filled:""},null,8,["modelValue"]),l(n,{modelValue:r.value.stock,"onUpdate:modelValue":e[9]||(e[9]=o=>r.value.stock=o),label:"Stock",filled:""},null,8,["modelValue"]),l(n,{modelValue:r.value.categoria,"onUpdate:modelValue":e[10]||(e[10]=o=>r.value.categoria=o),label:"Categoria",filled:""},null,8,["modelValue"]),l(n,{modelValue:r.value.estado,"onUpdate:modelValue":e[11]||(e[11]=o=>r.value.estado=o),label:"Estado",filled:"",type:"number",min:"0",max:"1"},null,8,["modelValue"])]),_:1}),l(w,null,{default:s(()=>[l(i,{label:"Cancelar",color:"secondary",flat:"",onClick:I}),l(i,{label:"Guardar Cambios",color:"primary",flat:"",onClick:P})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ne=M(oe,[["__scopeId","data-v-be20f463"]]);export{ne as default};
