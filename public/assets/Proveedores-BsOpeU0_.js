import{_ as q,r as u,e as M,o as G,f as H,w as n,b as g,d as m,a as l,Q as c,c as E,g as O,F as R,N as i,n as j,t as J}from"./index-DflF4O1K.js";import{Q as U,a as K,b as k}from"./QTable-Bs6ecnKK.js";import{Q as C,a as w}from"./QCard-Cw6hF3wu.js";import{u as W,g as X,a as P,Q as s,p as Y,b as D}from"./useAuth-x3ikKUGK.js";import{Q as Z}from"./QPage-BfKRdEGj.js";const ee={class:"main-btn-registrar"},oe={key:0,style:{color:"green"}},le={key:1,style:{color:"red"}},ae={__name:"Proveedores",setup(re){const I=u([{name:"nombre",align:"center",label:"Nombre",field:"nombre",sortable:!0,style:"font-weight: bold;"},{name:"identificacion",align:"center",label:"Identificación",field:"identificacion",sortable:!0},{name:"direccion",align:"center",label:"Dirección",field:"direccion",sortable:!0},{name:"telefono",align:"center",label:"Teléfono",field:"telefono",sortable:!0},{name:"email",align:"center",label:"Email",field:"email",sortable:!0},{name:"estado",align:"center",label:"Estado",field:"estado",sortable:!0,style:"font-weight: bold;"},{name:"opciones",align:"center",label:" Opciones",field:"opciones",sortable:!0}]),x=u([]),f=u(!1),v=u(!1),p=u(!1),d=u(!1),r=u({nombre:"",identificacion:"",direccion:"",telefono:"",email:"",tipo:"1"}),t=u({_id:"",nombre:"",identificacion:"",direccion:"",telefono:"",email:""}),y=u(null),N=W(),T=M(()=>r.value.nombre&&r.value.identificacion&&r.value.direccion&&r.value.telefono&&r.value.email);G(async()=>{await b()});async function b(){const a=N.getToken();if(console.log("Token recuperado del store",a),!a){console.log("Token no encontrado");return}try{const o=await X("terceros/proveedores");o&&Array.isArray(o)?x.value=o:console.log("La respuesta no contiene los datos esperados")}catch(o){console.log("Error al obtener los datos:",o.response?o.response.data:o)}}const A=a=>{y.value=a,f.value=!0},L=()=>{v.value=!0},_=()=>{v.value=!1,Q()},Q=()=>{r.value={nombre:"",identificacion:"",direccion:"",telefono:"",email:""}},z=async()=>{d.value=!0;try{r.value.nombre=r.value.nombre.trim(),r.value.identificacion=r.value.identificacion.trim(),r.value.direccion=r.value.direccion.trim(),r.value.telefono=r.value.telefono.trim(),r.value.email=r.value.email.trim(),console.log(r.value);const a=await Y("terceros",r.value);console.log("Proveedor creado con éxito",a),v.value=!1,i.create({message:"Proveedor registrado exitosamente",color:"green",icon:"check_circle",position:"top",timeout:3e3}),await b(),Q()}catch(a){console.log("Error al crear el proveedor:",a.response?a.response.data:a),console.log(a),a.response&&a.response.data&&a.response.data.errores?a.response.data.errores.forEach(e=>{e.msg?i.create({message:e.msg,color:"red",icon:"error",position:"top",timeout:3e3}):i.create({message:"Error desconocido",color:"red",icon:"error",position:"top",timeout:3e3})}):i.create({message:"Hubo un error en el registro. Inténtelo nuevamente.",color:"red",icon:"error",position:"top",timeout:3e3})}finally{d.value=!1}},B=a=>{t.value=a,p.value=!0},F=()=>{p.value=!1},S=async()=>{d.value=!0;try{t.value.nombre=t.value.nombre.trim(),t.value.identificacion=t.value.identificacion.trim(),t.value.direccion=t.value.direccion.trim(),t.value.telefono=t.value.telefono.trim(),t.value.email=t.value.email.trim();const a=await D(`terceros/${t.value._id}`,t.value);console.log("Proveedor editado con éxito",a),i.create({message:"Proveedor editado con éxito",color:"green",icon:"check_circle",position:"top",timeout:3e3}),p.value=!1,await b()}catch(a){if(console.log("Error al editar el proveedor:",a.response?a.response.data:a),a.response&&a.response.data&&a.response.data.errores){const o=a.response.data.errores;console.log("Errores del backend:",o),o.forEach(e=>{e.msg?i.create({message:e.msg,color:"red",icon:"error",position:"top",timeout:3e3}):i.create({message:"Error desconocido",color:"red",icon:"error",position:"top",timeout:3e3})})}else i.create({message:"Hubo un error al editar el proveedor. Inténtelo nuevamente.",color:"red",icon:"error",position:"top",timeout:3e3})}finally{d.value=!1}},$=async()=>{if(d.value=!0,!y.value)return;const a=y.value;a.estado=a.estado===1?0:1;try{const o=await D(`terceros/${a._id}`,{estado:a.estado});console.log("Estado actualizado con éxito:",o),i.create({message:"Estado actualizado con éxito",color:"green",icon:"check_circle",position:"top",timeout:3e3}),await b(),f.value=!1}catch(o){console.log("Error al actualizar el estado:",o.response?o.response.data:o),i.create({message:"Error al actualizar el estado",color:"red",icon:"error",position:"top",timeout:3e3})}finally{d.value=!1}},h=()=>{f.value=!1};return(a,o)=>(g(),H(Z,{padding:""},{default:n(()=>[o[16]||(o[16]=m("h4",{class:"text-center text-weight-bold"},"Proveedores",-1)),o[17]||(o[17]=m("hr",null,null,-1)),m("div",ee,[l(c,{label:"Registrar",onClick:L,class:"q-mb-md",id:"btn-registrar"})]),l(K,{class:"tabla-views",rows:x.value,columns:I.value,"row-key":"name"},{header:n(e=>[m("tr",null,[(g(!0),E(R,null,O(e.cols,V=>(g(),E("th",{key:V.name,class:j("tabla-header")},[m("span",null,J(V.label),1)]))),128))])]),"body-cell-estado":n(e=>[l(U,{props:e,class:"q-pa-sm"},{default:n(()=>[e.row.estado==1?(g(),E("span",oe,"Activo")):(g(),E("span",le,"Inactivo"))]),_:2},1032,["props"])]),"body-cell-opciones":n(e=>[l(U,{props:e,class:"tabla-cell opciones"},{default:n(()=>[l(c,{icon:"edit",color:"primary",flat:"",onClick:V=>B(e.row),class:"q-mr-sm"},null,8,["onClick"]),l(c,{icon:e.row.estado===1?"remove_circle":"check_circle",color:e.row.estado===1?"negative":"positive",flat:"",onClick:V=>A(e.row)},null,8,["icon","color","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),l(k,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=e=>f.value=e)},{default:n(()=>[l(C,null,{default:n(()=>[o[13]||(o[13]=m("div",{class:"text-h6"},"¿Estás seguro de cambiar el estado?",-1)),l(w),l(P,null,{default:n(()=>[l(c,{label:"Cancelar",color:"secondary",flat:"",onClick:h}),l(c,{label:"Confirmar",loading:d.value,color:"primary",flat:"",onClick:$},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(k,{modelValue:v.value,"onUpdate:modelValue":o[6]||(o[6]=e=>v.value=e),persistent:""},{default:n(()=>[l(C,null,{default:n(()=>[o[14]||(o[14]=m("div",{class:"text-h6"},"Agregar Nuevo Proveedor",-1)),l(w,null,{default:n(()=>[l(s,{modelValue:r.value.nombre,"onUpdate:modelValue":o[1]||(o[1]=e=>r.value.nombre=e),label:"Nombre",filled:"",rules:[e=>e&&e.length>0||"El nombre es obligatorio"]},null,8,["modelValue","rules"]),l(s,{modelValue:r.value.identificacion,"onUpdate:modelValue":o[2]||(o[2]=e=>r.value.identificacion=e),label:"Identificacion",filled:"",rules:[e=>e&&e.length>0||"La identificacion es obligatoria"]},null,8,["modelValue","rules"]),l(s,{modelValue:r.value.direccion,"onUpdate:modelValue":o[3]||(o[3]=e=>r.value.direccion=e),label:"Dirección",filled:"",rules:[e=>e&&e.length>0||"La dirección es obligatoria"]},null,8,["modelValue","rules"]),l(s,{modelValue:r.value.telefono,"onUpdate:modelValue":o[4]||(o[4]=e=>r.value.telefono=e),label:"Teléfono",filled:"",rules:[e=>e&&e.length>0||"El telefono es obligatorio",e=>e.length===10||"El telefono debe tener 10 digitos"]},null,8,["modelValue","rules"]),l(s,{modelValue:r.value.email,"onUpdate:modelValue":o[5]||(o[5]=e=>r.value.email=e),label:"Email",filled:"",rules:[e=>e&&e.length>0||"El email es obligatorio",e=>/.+@.+\..+/.test(e)||"El email debe ser válido"]},null,8,["modelValue","rules"])]),_:1}),l(P,null,{default:n(()=>[l(c,{label:"Cancelar",color:"secondary",flat:"",onClick:_}),l(c,{label:"Guardar",color:"primary",loading:d.value,flat:"",onClick:z,disable:!T.value},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(k,{modelValue:p.value,"onUpdate:modelValue":o[12]||(o[12]=e=>p.value=e),persistent:""},{default:n(()=>[l(C,null,{default:n(()=>[o[15]||(o[15]=m("div",{class:"text-h6"},"Editar Proveedor",-1)),l(w,null,{default:n(()=>[l(s,{modelValue:t.value.nombre,"onUpdate:modelValue":o[7]||(o[7]=e=>t.value.nombre=e),label:"Nombre",filled:"",rules:[e=>e&&e.length>0||"El nombre es obligatorio"]},null,8,["modelValue","rules"]),l(s,{modelValue:t.value.identificacion,"onUpdate:modelValue":o[8]||(o[8]=e=>t.value.identificacion=e),label:"Identificacion",filled:"",rules:[e=>e&&e.length>0||"La identificacion es obligatoria"]},null,8,["modelValue","rules"]),l(s,{modelValue:t.value.direccion,"onUpdate:modelValue":o[9]||(o[9]=e=>t.value.direccion=e),label:"Dirección",filled:"",rules:[e=>e&&e.length>0||"La direccione es obligatoria"]},null,8,["modelValue","rules"]),l(s,{modelValue:t.value.telefono,"onUpdate:modelValue":o[10]||(o[10]=e=>t.value.telefono=e),label:"Teléfono",filled:"",rules:[e=>e&&e.length>0||"El telefono es obligatorio"]},null,8,["modelValue","rules"]),l(s,{modelValue:t.value.email,"onUpdate:modelValue":o[11]||(o[11]=e=>t.value.email=e),label:"Email",filled:"",rules:[e=>e&&e.length>0||"El email es obligatorio",e=>/.+@.+\..+/.test(e)||"El email debe ser válido"]},null,8,["modelValue","rules"])]),_:1}),l(P,null,{default:n(()=>[l(c,{label:"Cancelar",color:"secondary",flat:"",onClick:F}),l(c,{label:"Guardar Cambios",color:"primary",loading:d.value,flat:"",onClick:S},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ue=q(ae,[["__scopeId","data-v-5e803a71"]]);export{ue as default};
