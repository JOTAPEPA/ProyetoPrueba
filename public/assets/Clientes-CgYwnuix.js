import{_ as M,r as d,e as G,o as H,c as O,w as n,a as v,d as m,b as o,Q as c,f as V,g as P,F as R,N as i,n as j,t as J}from"./index-BEGkFgSe.js";import{Q as D,a as K,b as y}from"./QTable-DN77hU1r.js";import{b as W,a as k,Q as w}from"./QPage-BzMxdbeg.js";import{u as X,g as Y,a as x,Q as s,p as Z,b as I}from"./useAuth-Dj6XO5Da.js";const ee={class:"main-btn-registrar"},le={key:0,style:{color:"green"}},oe={key:1,style:{color:"red"}},ae={__name:"Clientes",setup(te){const N=d([{name:"nombre",align:"center",label:"Nombre",field:"nombre",sortable:!0,style:"font-weight: bold;"},{name:"identificacion",align:"center",label:"Identificación",field:"identificacion",sortable:!0},{name:"direccion",align:"center",label:"Dirección",field:"direccion",sortable:!0},{name:"telefono",align:"center",label:"Teléfono",field:"telefono",sortable:!0},{name:"email",align:"center",label:"Email",field:"email",sortable:!0},{name:"estado",align:"center",label:"Estado",field:"estado",sortable:!0,style:"font-weight: bold;"},{name:"opciones",align:"center",label:" Opciones",field:"opciones",sortable:!0}]),Q=d([]),f=d(!1),b=d(!1),p=d(!1),u=d(!1),t=d({nombre:"",identificacion:"",direccion:"",telefono:"",email:"",tipo:"0"}),r=d({_id:"",nombre:"",identificacion:"",direccion:"",telefono:"",email:""}),E=d(null),T=X(),A=G(()=>t.value.nombre&&t.value.identificacion&&t.value.direccion&&t.value.telefono&&t.value.email);H(async()=>{await g()});async function g(){const a=T.getToken();if(console.log("Token recuperado del store",a),!a){console.log("Token no encontrado");return}try{const l=await Y("terceros/clientes");l&&Array.isArray(l)?Q.value=l:console.log("La respuesta no contiene los datos esperados")}catch(l){console.log("Error al obtener los datos:",l.response?l.response.data:l)}}const L=a=>{E.value=a,f.value=!0},_=()=>{b.value=!0},z=()=>{b.value=!1,U()},U=()=>{t.value={nombre:"",identificacion:"",direccion:"",telefono:"",email:"",estado:1}},B=async()=>{u.value=!0;try{t.value.nombre=t.value.nombre.trim(),t.value.identificacion=t.value.identificacion.trim(),t.value.direccion=t.value.direccion.trim(),t.value.telefono=t.value.telefono.trim(),t.value.email=t.value.email.trim();const a=await Z("terceros",t.value);console.log("Cliente creado con éxito",a),b.value=!1,i.create({message:"Cliente registrado exitosamente",color:"green",icon:"check_circle",position:"top",timeout:3e3}),await g(),U()}catch(a){console.log("Error al crear cliente:",a.response?a.response.data:a),a.response&&a.response.data&&a.response.data.errores?a.response.data.errores.forEach(e=>{e.msg?i.create({message:e.msg,color:"red",icon:"error",position:"top",timeout:3e3}):i.create({message:"Error desconocido",color:"red",icon:"error",position:"top",timeout:3e3})}):i.create({message:"Hubo un error en el registro. Inténtelo nuevamente.",color:"red",icon:"error",position:"top",timeout:3e3})}finally{u.value=!1}},F=a=>{r.value=a,p.value=!0},S=()=>{p.value=!1},$=async()=>{u.value=!0;try{r.value.nombre=r.value.nombre.trim(),r.value.identificacion=r.value.identificacion.trim(),r.value.direccion=r.value.direccion.trim(),r.value.telefono=r.value.telefono.trim(),r.value.email=r.value.email.trim();const a=await I(`terceros/${r.value._id}`,r.value);console.log("Cliente editado con éxito",a),i.create({message:"Cliente editado con éxito",color:"green",icon:"check_circle",position:"top",timeout:3e3}),p.value=!1,await g()}catch(a){if(console.log("Error al editar el Cliente:",a.response?a.response.data:a),a.response&&a.response.data&&a.response.data.errores){const l=a.response.data.errores;console.log("Errores del backend:",l),l.forEach(e=>{e.msg?i.create({message:e.msg,color:"red",icon:"error",position:"top",timeout:3e3}):i.create({message:"Error desconocido",color:"red",icon:"error",position:"top",timeout:3e3})})}else i.create({message:"Hubo un error al editar el Cliente. Inténtelo nuevamente.",color:"red",icon:"error",position:"top",timeout:3e3})}finally{u.value=!1}},h=async()=>{if(u.value=!0,!E.value)return;const a=E.value;a.estado=a.estado===1?0:1;try{const l=await I(`terceros/${a._id}`,{estado:a.estado});console.log("Estado actualizado con éxito:",l),i.create({message:"Estado actualizado con éxito",color:"green",icon:"check_circle",position:"top",timeout:3e3}),await g(),f.value=!1}catch(l){console.log("Error al actualizar el estado:",l.response?l.response.data:l),i.create({message:"Error al actualizar el estado",color:"red",icon:"error",position:"top",timeout:3e3})}finally{u.value=!1}},q=()=>{f.value=!1};return(a,l)=>(v(),O(W,{padding:""},{default:n(()=>[l[16]||(l[16]=m("h4",{class:"text-center text-weight-bold"},"Clientes",-1)),l[17]||(l[17]=m("hr",null,null,-1)),m("div",ee,[o(c,{label:"Registrar",onClick:_,class:"q-mb-md",id:"btn-registrar"})]),o(K,{class:"tabla-views",rows:Q.value,columns:N.value,"row-key":"name"},{header:n(e=>[m("tr",null,[(v(!0),V(R,null,P(e.cols,C=>(v(),V("th",{key:C.name,class:j("tabla-header")},[m("span",null,J(C.label),1)]))),128))])]),"body-cell-estado":n(e=>[o(D,{props:e,class:"q-pa-sm"},{default:n(()=>[e.row.estado==1?(v(),V("span",le,"Activo")):(v(),V("span",oe,"Inactivo"))]),_:2},1032,["props"])]),"body-cell-opciones":n(e=>[o(D,{props:e,class:"tabla-cell opciones"},{default:n(()=>[o(c,{icon:"edit",color:"primary",flat:"",onClick:C=>F(e.row),class:"q-mr-sm"},null,8,["onClick"]),o(c,{icon:e.row.estado===1?"remove_circle":"check_circle",color:e.row.estado===1?"negative":"positive",flat:"",onClick:C=>L(e.row)},null,8,["icon","color","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"]),o(y,{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=e=>f.value=e)},{default:n(()=>[o(k,null,{default:n(()=>[l[13]||(l[13]=m("div",{class:"text-h6"},"¿Estás seguro de cambiar el estado?",-1)),o(w),o(x,null,{default:n(()=>[o(c,{label:"Cancelar",color:"secondary",flat:"",onClick:q}),o(c,{label:"Confirmar",loading:u.value,color:"primary",flat:"",onClick:h},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(y,{modelValue:b.value,"onUpdate:modelValue":l[6]||(l[6]=e=>b.value=e),persistent:""},{default:n(()=>[o(k,null,{default:n(()=>[l[14]||(l[14]=m("div",{class:"text-h6"},"Agregar Nuevo Cliente",-1)),o(w,null,{default:n(()=>[o(s,{modelValue:t.value.nombre,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.nombre=e),label:"Nombre",filled:"",rules:[e=>e&&e.length>0||"El nombre es obligatorio"]},null,8,["modelValue","rules"]),o(s,{modelValue:t.value.identificacion,"onUpdate:modelValue":l[2]||(l[2]=e=>t.value.identificacion=e),label:"Identificacion",filled:"",rules:[e=>e&&e.length>0||"La identificacion es obligatoria"]},null,8,["modelValue","rules"]),o(s,{modelValue:t.value.direccion,"onUpdate:modelValue":l[3]||(l[3]=e=>t.value.direccion=e),label:"Dirección",filled:"",rules:[e=>e&&e.length>0||"La dirección es obligatoria"]},null,8,["modelValue","rules"]),o(s,{modelValue:t.value.telefono,"onUpdate:modelValue":l[4]||(l[4]=e=>t.value.telefono=e),label:"Teléfono",filled:"",rules:[e=>e&&e.length>0||"El telefono es obligatorio",e=>e.length===10||"El telefono debe tener 10 digitos"]},null,8,["modelValue","rules"]),o(s,{modelValue:t.value.email,"onUpdate:modelValue":l[5]||(l[5]=e=>t.value.email=e),label:"Email",filled:"",rules:[e=>e&&e.length>0||"El email es obligatorio",e=>/.+@.+\..+/.test(e)||"El email debe ser válido"]},null,8,["modelValue","rules"])]),_:1}),o(x,null,{default:n(()=>[o(c,{label:"Cancelar",color:"secondary",flat:"",onClick:z}),o(c,{label:"Guardar",color:"primary",loading:u.value,flat:"",onClick:B,disable:!A.value},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(y,{modelValue:p.value,"onUpdate:modelValue":l[12]||(l[12]=e=>p.value=e),persistent:""},{default:n(()=>[o(k,null,{default:n(()=>[l[15]||(l[15]=m("div",{class:"text-h6"},"Editar Cliente",-1)),o(w,null,{default:n(()=>[o(s,{modelValue:r.value.nombre,"onUpdate:modelValue":l[7]||(l[7]=e=>r.value.nombre=e),label:"Nombre",filled:"",rules:[e=>e&&e.length>0||"El nombre es obligatorio"]},null,8,["modelValue","rules"]),o(s,{modelValue:r.value.identificacion,"onUpdate:modelValue":l[8]||(l[8]=e=>r.value.identificacion=e),label:"Identificacion",filled:"",rules:[e=>e&&e.length>0||"La identificacion es obligatoria"]},null,8,["modelValue","rules"]),o(s,{modelValue:r.value.direccion,"onUpdate:modelValue":l[9]||(l[9]=e=>r.value.direccion=e),label:"Dirección",filled:"",rules:[e=>e&&e.length>0||"La direccione es obligatoria"]},null,8,["modelValue","rules"]),o(s,{modelValue:r.value.telefono,"onUpdate:modelValue":l[10]||(l[10]=e=>r.value.telefono=e),label:"Teléfono",filled:"",rules:[e=>e&&e.length>0||"El telefono es obligatorio"]},null,8,["modelValue","rules"]),o(s,{modelValue:r.value.email,"onUpdate:modelValue":l[11]||(l[11]=e=>r.value.email=e),label:"Email",filled:"",rules:[e=>e&&e.length>0||"El email es obligatorio",e=>/.+@.+\..+/.test(e)||"El email debe ser válido"]},null,8,["modelValue","rules"])]),_:1}),o(x,null,{default:n(()=>[o(c,{label:"Cancelar",color:"secondary",flat:"",onClick:S}),o(c,{label:"Guardar Cambios",loading:u.value,color:"primary",flat:"",onClick:$},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ue=M(ae,[["__scopeId","data-v-1f48f60f"]]);export{ue as default};
